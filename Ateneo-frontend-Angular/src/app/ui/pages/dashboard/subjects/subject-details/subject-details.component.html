<div class="subject-details-container">
    <div class="students-table-container">
        <div class="table-wrapper">
            <mat-table [dataSource]="studentsList" class="students-table">
                <ng-container matColumnDef="identification">
                    <mat-header-cell *matHeaderCellDef>Identificación</mat-header-cell>
                    <mat-cell *matCellDef="let student">{{ student.identification }}</mat-cell>
                </ng-container>

                <ng-container matColumnDef="name">
                    <mat-header-cell *matHeaderCellDef>Estudiante</mat-header-cell>
                    <mat-cell *matCellDef="let student">{{ student.name }}</mat-cell>
                </ng-container>

                <ng-container matColumnDef="grade1">
                    <mat-header-cell *matHeaderCellDef>Nota 1</mat-header-cell>
                    <mat-cell *matCellDef="let student">{{ student.grade1 }}</mat-cell>
                </ng-container>

                <ng-container matColumnDef="grade2">
                    <mat-header-cell *matHeaderCellDef>Nota 2</mat-header-cell>
                    <mat-cell *matCellDef="let student">{{ student.grade2 }}</mat-cell>
                </ng-container>

                <ng-container matColumnDef="gradeN">
                    <mat-header-cell *matHeaderCellDef>Nota n</mat-header-cell>
                    <mat-cell *matCellDef="let student">{{ student.gradeN }}</mat-cell>
                </ng-container>

                <ng-container matColumnDef="attendance">
                    <mat-header-cell *matHeaderCellDef>Asistencias</mat-header-cell>
                    <mat-cell *matCellDef="let student">{{ student.attendance }}</mat-cell>
                </ng-container>

                <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
                <mat-row *matRowDef="let row; columns: displayedColumns"></mat-row>
            </mat-table>
        </div>
    </div>
    <div class="calendar-container">
        <h3>Calendario de Clases</h3>
        <mat-calendar
            [(selected)]="selectedDate"
            [dateClass]="dateClass"
            (selectedChange)="onDateSelected($event)"
            (click)="onDateSelected(selectedDate)"
        ></mat-calendar>
    </div>
    <div class="buttons-container">Acá van a ir los botones</div>
</div>

<ng-template #modalOcupada>
    <div class="modal-clase-cargada">
        <div class="clase-cargada-inasistencias">
            <h4>Inasistencias</h4>
            <div class="inasistencias-table">
                <div class="inasistencias-row inasistencias-header">
                    <div class="inasistencias-nombre">Alumno</div>
                    <div class="inasistencias-justificado">Justificado</div>
                </div>
                <div class="inasistencias-row" *ngFor="let student of loadedClass.absentStudents">
                    <div class="inasistencias-nombre" title="{{ student.name }}">{{ student.name }}</div>
                    <div class="inasistencias-justificado">
                        <mat-checkbox [checked]="student.justificado" disabled class="custom-checkbox"></mat-checkbox>
                    </div>
                </div>
            </div>
        </div>
        <mat-form-field appearance="outline" class="full-width class-description" style="width: 100%">
            <mat-label>Descripción de la clase</mat-label>
            <textarea
                matInput
                [(ngModel)]="loadedClass.description"
                placeholder="Agrega una descripción para la clase"
                rows="3"
                class="class-description-textarea"
                maxlength="140"
                disabled
            ></textarea>
        </mat-form-field>
    </div>
</ng-template>

<ng-template #modalLibre>
    <div class="modal-libre-container">
        <button class="primary-button button-toggle-modal-libre full-width-btn" mat-flat-button (click)="toggleModalView()">
            {{ showAltModal ? 'Cargar inasistencias' : 'Ver inasistencias cargadas' }}
        </button>
        <ng-container *ngIf="!showAltModal; else altModalContent">
            <div class="inputs-column">
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Alumno con inasistencia</mat-label>
                    <input
                        matInput
                        placeholder="Nombre del Alumno"
                        [(ngModel)]="studentSearch"
                        (ngModelChange)="filterStudents()"
                        autocomplete="off"
                    />
                </mat-form-field>
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Seleccionar alumno</mat-label>
                    <mat-select
                        [(ngModel)]="selectedStudent"
                        [disabled]="filteredStudents.length === 0"
                        (selectionChange)="addSelectedStudent($event.value)"
                    >
                        <mat-option *ngIf="filteredStudents.length === 0" disabled>Ningún alumno encontrado</mat-option>
                        <mat-option *ngFor="let student of filteredStudents" [value]="student">
                            {{ student.name }}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
                <mat-form-field appearance="outline" class="full-width class-description">
                    <mat-label>Descripción de la clase (opcional)</mat-label>
                    <textarea
                        matInput
                        [(ngModel)]="classDescription"
                        placeholder="Agrega una descripción para la clase"
                        rows="3"
                        class="class-description-textarea"
                        maxlength="140"
                    ></textarea>
                    <div class="char-counter">{{ classDescription.length || 0 }}/140</div>
                </mat-form-field>
            </div>
        </ng-container>
        <ng-template #altModalContent>
            <div class="alt-modal-content">
                <h3>Inasistencias seleccionadas</h3>
                <div *ngIf="selectedStudents.length === 0">No hay alumnos seleccionados.</div>
                <div
                    *ngFor="let student of selectedStudents"
                    class="selected-student-item"
                    style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px"
                >
                    <mat-icon (click)="removeSelectedStudent(student)">close</mat-icon>
                    <span>{{ student.name }}</span>
                    <span class="justificado-label">Justificado</span>
                    <mat-checkbox [(ngModel)]="student.justificado" class="custom-checkbox"></mat-checkbox>
                </div>
            </div>
        </ng-template>
    </div>
</ng-template>
